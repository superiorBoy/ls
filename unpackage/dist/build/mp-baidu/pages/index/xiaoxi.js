(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/xiaoxi"],{"0110":function(e,t,i){"use strict";i.r(t);var o=i("f77d"),n=i("c943");for(var a in n)"default"!==a&&function(e){i.d(t,e,(function(){return n[e]}))}(a);i("8f83");var s,r=i("f0c5"),u=Object(r["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);t["default"]=u.exports},"1a10":function(e,t,i){"use strict";(function(e){i("0743");o(i("66fd"));var t=o(i("0110"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,i("5486")["createPage"])},3940:function(e,t,i){},"66bb":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(){Promise.all([i.e("common/vendor"),i.e("components/feng-parse/parse")]).then(function(){return resolve(i("e3f1"))}.bind(null,i)).catch(i.oe)},n=function(){i.e("components/y_tabbar/tabbar").then(function(){return resolve(i("85c1"))}.bind(null,i)).catch(i.oe)},a={created:function(){},components:{uParse:o,tabBar:n},onShow:function(){var t=this,i=this;this.$http.post({url:"/index/login/islogin"}).then((function(o){if(""!=o.data.user){2==o.data.user.grade&&e.reLaunch({url:"../ls/xiaoxi"});var n=e.getStorageSync("user_chat_list");n?(n=JSON.parse(n),console.log(n),i.xiaoxi_list=n,i.$forceUpdate(),i.theKey++):(console.log("缓存不存在"),t.page=0,t.is_all=!1,i.xiaoxi_list=[],i.huoqu_xiaoxilist()),t.$refs.mainindex.huoqunum()}}))},onLoad:function(){},onHide:function(){},onUnload:function(){},data:function(){return{currentPage:"index/xiaoxi",tabs:["图文咨询","电话咨询"],img_url:e.getStorageSync("img_url"),active:"0",xiaoxi_list:[],islogin:"",theKey:0,is_all:!1,page:0,chumo_index:-1}},onPullDownRefresh:function(){this.page=0,this.is_all=!1,this.xiaoxi_list=[],this.huoqu_xiaoxilist()},methods:{onReachBottom:function(){if(console.log("jiazai"),this.is_all)return e.showToast({title:"没有更多内容了",duration:2e3,icon:"none"}),e.stopPullDownRefresh(),!1;this.page++,this.huoqu_xiaoxilist()},app_lianjie:function(){var t=this,i=t.$http.WebSocket_url;e.connectSocket({url:"wss://"+i+":3348",success:function(e){console.log("websocket连接成功",e)},fail:function(e){},complete:function(e){}}),e.onSocketOpen((function(e){console.log("WebSocket连接已打开！",e)})),e.onSocketError((function(e){console.log("WebSocket连接打开失败，请检查！")})),e.onSocketMessage((function(i){var o=JSON.parse(i.data);"init"==o.type?(console.log("init"),console.log("client_id",o.client_id),e.request({url:t.$http.baseUrl+"/push/gatewayworker/bind",method:"POST",data:{client_id:o.client_id},success:function(e){console.log(e,"bind")},fail:function(e){}})):"say"==o.type?(console.log("say"),o.state&&(t.jieshou_xiaoxi(o),t.$refs.mainindex.huoqunum())):console.log("else")})),e.onSocketClose((function(e){console.log("uniapp 已关闭！")}))},xiaoxi_qiehuan:function(e){this.active=e},replace_em:function(e){return e=e.replace(/\</g,"&lt;"),e=e.replace(/\>/g,"&gt;"),e=e.replace(/\n/g,"<br/>"),e=e.replace(/\[em_([0-9]*)\]/g,'<img src="../../static/bkhumor-emoji/$1.gif" border="0" style="width:40rpx"/>'),e},go_chat:function(t){var i=this;this.xiaoxi_list.forEach((function(e,i,o){console.log(e),e.lawyerid==t&&(e.readnum=0)})),i.$refs.mainindex.huoqunum(),e.navigateTo({url:"chat?lawyerid="+t})},go_kefu:function(){var t=this;t.$refs.mainindex.huoqunum(),e.navigateTo({url:"chat?lawyerid=7"})},go_gonggao:function(){e.navigateTo({url:"gonggao"})},huoqu_xiaoxilist:function(){var t=this;console.log("huoqu_xiaoxi","请求列表");var i=this;this.$http.post({url:"/mapi/consult/messagelist1",data:{page:this.page}}).then((function(o){i.xiaoxi_list=i.xiaoxi_list.concat(o.data.messagelist),o.data.messagelist.length<o.data.count&&(i.is_all=!0),i.$forceUpdate(),i.theKey++,e.setStorageSync("user_chat_list",JSON.stringify(t.xiaoxi_list))}))},connectSocketInit:function(){var t=this,i=window.location.host,o=new WebSocket("wss://"+i+":3348");o.onopen=function(e){console.log("Connection open ...")},o.onmessage=function(i){console.log("Received Message: "+i.data);var o=JSON.parse(i.data);"init"==o.type?(console.log("init"),console.log("client_id",o.client_id),e.request({url:t.$http.baseUrl+"/push/gatewayworker/bind",method:"POST",data:{client_id:o.client_id},success:function(e){console.log(e,"bind")},fail:function(e){}})):"say"==o.type?(console.log("say"),o.state&&(t.jieshou_xiaoxi(o),t.$refs.mainindex.huoqunum())):console.log("else")},o.onclose=function(e){console.log("Connection closed.")},o.onerror=function(e){console.log("WebSocketError!",e)}},jieshou_xiaoxi:function(t){for(var i=this,o=this.xiaoxi_list,n=!1,a=0;a<o.length;a++)if(o[a].lawyer.userid==t.userid_from){console.log("存在"),n=!0;var s=o[a].readnum;o.splice(a,1);var r={addtime:(new Date).getTime(),uptime:(new Date).getTime(),content:t.msg,lawyerid:t.userid_from,lawyerreadnum:1,msgtype:t.state,readnum:s+1,lawyer:{userid:t.userid_from,photourl:t.userid_from_pic,nickname:t.userid_from_nickname,mobile:t.userid_from_mobile},userid:t.userid_to};o.unshift(r),this.xiaoxi_list=o,i.$refs.mainindex.huoqunum(),i.$forceUpdate(),i.theKey++,e.setStorageSync("user_chat_list",JSON.stringify(i.xiaoxi_list))}if(!n){console.log("不存在");r={addtime:(new Date).getTime(),uptime:(new Date).getTime(),content:t.msg,lawyerid:t.userid_from,lawyerreadnum:1,msgtype:t.state,readnum:1,lawyer:{userid:t.userid_from,photourl:t.userid_from_pic,nickname:t.userid_from_nickname,mobile:t.userid_from_mobile},userid:t.userid_to};o.unshift(r),this.xiaoxi_list=o,i.$refs.mainindex.huoqunum(),i.$forceUpdate(),i.theKey++,e.setStorageSync("user_chat_list",JSON.stringify(i.xiaoxi_list))}},kaishi:function(e){this.chumo_index=e},songkai:function(){console.log("4444444"),this.chumo_index=-1}},filters:{timeStamp:function(e){if(null==e)return"null";var t=(e+"").length;while(t++<13)e+="0";e=Number(e);var i=new Date(e),o=i.getMonth()+1,n=i.getHours();n<10&&(n="0"+n);var a=i.getMinutes();a<10&&(a="0"+a);var s=i.getFullYear()+"-"+o+"-"+i.getDate()+" "+n+":"+a;return s}}};t.default=a}).call(this,i("5486")["default"])},"8f83":function(e,t,i){"use strict";var o=i("3940"),n=i.n(o);n.a},c943:function(e,t,i){"use strict";i.r(t);var o=i("66bb"),n=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,(function(){return o[e]}))}(a);t["default"]=n.a},f77d:function(e,t,i){"use strict";var o;i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){return o}));var n=function(){var e=this,t=e.$createElement,i=(e._self._c,e.__map(e.xiaoxi_list,(function(t,i){var o=e.__get_orig(t),n=t.lawyer&&1==t.msgtype&&1!=t.iswithdraw?e.replace_em(t.content):null,a=t.lawyer?e._f("timeStamp")(t.uptime):null;return{$orig:o,m0:n,f0:a}})));e.$mp.data=Object.assign({},{$root:{l0:i}})},a=[]}},[["1a10","common/runtime","common/vendor"]]]);