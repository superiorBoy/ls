(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/ls/xiaoxi"],{"1d3d":function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(){Promise.all([i.e("common/vendor"),i.e("components/feng-parse/parse")]).then(function(){return resolve(i("e3f1"))}.bind(null,i)).catch(i.oe)},n=function(){i.e("components/tabbar/tabbar").then(function(){return resolve(i("c366"))}.bind(null,i)).catch(i.oe)},s={components:{uParse:o,tabBar:n},created:function(){},onShow:function(){var t=this,i=this,o=e.getStorageSync("ls_chat_list");o?(o=JSON.parse(o),i.xiaoxi_list=o,i.$forceUpdate(),i.theKey++):(this.page=0,this.is_all=!1,this.xiaoxi_list=[],this.huoqu_xiaoxilist());i=this;this.$http.post({url:"/lawyer/login/islogin"}).then((function(e){""!=e.data.user?(i.$refs.ls_mainindex.huoqunum(),t.$http.post({url:"/mlawyerapi/lawyer/lawyerclick"}).then((function(e){}))):t.is_login=!1}))},onHide:function(){console.log("关闭当前页面")},beforeDestroy:function(){e.removeStorageSync("ls_chat_list"),console.log("beforeDestroy")},onLoad:function(){console.log("load"),this.huoqu_user()},data:function(){return{currentPage:"ls/xiaoxi",tabs:["图文咨询","电话咨询"],img_url:e.getStorageSync("img_url"),active:"0",xiaoxi_list:[],weidu:0,theKey:0,is_all:!1,page:0,chumo_index:-1}},onPullDownRefresh:function(){this.page=0,this.is_all=!1,this.xiaoxi_list=[],this.huoqu_xiaoxilist()},methods:{onReachBottom:function(){if(console.log("jiazai"),this.is_all)return e.showToast({title:"没有更多内容了",duration:2e3,icon:"none"}),e.stopPullDownRefresh(),!1;this.page++,this.huoqu_xiaoxilist()},huoqu_user:function(){this.$http.post({url:"/mlawyerapi/user/getlawyer"}).then((function(t){t.data.user||e.redirectTo({url:"shiming_renzheng"}),2==t.data.user.isreal||3==t.data.user.isreal||4==t.data.user.isreal?e.redirectTo({url:"shiming_renzheng"}):2!=t.data.user.iszhiye&&3!=t.data.user.iszhiye&&4!=t.data.user.iszhiye||e.redirectTo({url:"zhiye_renzheng"})}))},app_lianjie:function(){var t=this,i=t.$http.WebSocket_url;e.connectSocket({url:"wss://"+i+":3348",success:function(e){console.log("websocket连接成功",e)},fail:function(e){},complete:function(e){}}),e.onSocketOpen((function(e){console.log("WebSocket连接已打开！",e)})),e.onSocketError((function(e){console.log("WebSocket连接打开失败，请检查！")})),e.onSocketMessage((function(i){var o=JSON.parse(i.data);"init"==o.type?(console.log("init"),console.log("client_id",o.client_id),e.request({url:t.$http.baseUrl+"/push/gatewayworker/bind",method:"POST",data:{client_id:o.client_id,type:1},success:function(e){console.log(e,"bind")},fail:function(e){}})):"say"==o.type?(console.log("say"),o.state&&(t.jieshou_xiaoxi(o),t.$refs.ls_mainindex.huoqunum())):console.log("else")})),e.onSocketClose((function(e){console.log("uniapp 已关闭！")}))},xiaoxi_qiehuan:function(e){this.active=e},replace_em:function(e){return e=e.replace(/\</g,"&lt;"),e=e.replace(/\>/g,"&gt;"),e=e.replace(/\n/g,"<br/>"),e=e.replace(/\[em_([0-9]*)\]/g,'<img src="../../static/bkhumor-emoji/$1.gif" border="0" style="width:40rpx"/>'),e},go_chat:function(t){var i=this;this.xiaoxi_list.forEach((function(e,i,o){e.user.userid==t&&(e.lawyerreadnum=0)})),i.$refs.ls_mainindex.huoqunum(),e.navigateTo({url:"chat?userid="+t})},go_gonggao:function(){e.navigateTo({url:"../index/gonggao"})},go_kefu:function(){var t=this;t.$refs.ls_mainindex.huoqunum(),e.navigateTo({url:"chat?userid=7"})},huoqu_xiaoxilist:function(){console.log("请求列表");var t=this;this.$http.post({url:"/mlawyerapi/consult/messagelist1",data:{page:this.page}}).then((function(i){t.xiaoxi_list=t.xiaoxi_list.concat(i.data.messagelist),i.data.messagelist.length<i.data.count&&(t.is_all=!0),t.$forceUpdate(),t.theKey++,e.setStorageSync("ls_chat_list",JSON.stringify(t.xiaoxi_list))}))},connectSocketInit:function(){var t=this,i=window.location.host,o=new WebSocket("wss://"+i+":3348");o.onopen=function(e){console.log("Connection open ...")},o.onmessage=function(i){console.log("Received Message: "+i.data);var o=JSON.parse(i.data);"init"==o.type?(console.log("init"),console.log("client_id",o.client_id),e.request({url:t.$http.baseUrl+"/push/gatewayworker/bind",method:"POST",data:{client_id:o.client_id,type:1},success:function(e){console.log(e,"bind")},fail:function(e){}})):"say"==o.type?(console.log("say"),o.state&&(t.jieshou_xiaoxi(o),t.$refs.ls_mainindex.huoqunum())):console.log("else")},o.onclose=function(e){console.log("Connection closed.")},o.onerror=function(e){console.log("WebSocketError!",e)}},jieshou_xiaoxi:function(t){var i=this,o=this.xiaoxi_list,n=!1;console.log(t,"收到消息");for(var s=0;s<o.length;s++)if(o[s].user.userid==t.userid_from){n=!0;var a=o[s].lawyerreadnum;console.log(s,"存在联系人",a,o[s]),o.splice(s,1);var r={addtime:(new Date).getTime(),uptime:(new Date).getTime(),content:t.msg,lawyerid:t.userid_from,lawyerreadnum:a+1,msgtype:t.state,readnum:1,user:{userid:t.userid_from,photourl:t.userid_from_pic,nickname:t.userid_from_nickname,mobile:t.userid_from_mobile},userid:t.userid_to};o.unshift(r),i.xiaoxi_list=o,i.$refs.ls_mainindex.huoqunum(),i.$forceUpdate(),i.theKey++,e.setStorageSync("ls_chat_list",JSON.stringify(i.xiaoxi_list))}if(console.log("bucaunzai",n),!n){console.log("bucaunzai");r={addtime:(new Date).getTime(),uptime:(new Date).getTime(),content:t.msg,lawyerid:t.userid_from,lawyerreadnum:1,msgtype:t.state,readnum:1,user:{userid:t.userid_from,photourl:t.userid_from_pic,nickname:t.userid_from_nickname,mobile:t.userid_from_mobile},userid:t.userid_to};o.unshift(r),i.xiaoxi_list=o,i.$refs.ls_mainindex.huoqunum(),i.$forceUpdate(),i.theKey++,e.setStorageSync("ls_chat_list",JSON.stringify(i.xiaoxi_list))}},kaishi:function(e){this.chumo_index=e},songkai:function(){this.chumo_index=-1}},filters:{timeStamp:function(e){if(null==e)return"null";var t=(e+"").length;while(t++<13)e+="0";e=Number(e);var i=new Date(e),o=i.getMonth()+1,n=i.getHours();n<10&&(n="0"+n);var s=i.getMinutes();s<10&&(s="0"+s);var a=i.getFullYear()+"-"+o+"-"+i.getDate()+" "+n+":"+s;return a}}};t.default=s}).call(this,i("5486")["default"])},"4c34":function(e,t,i){"use strict";(function(e){i("0743");o(i("66fd"));var t=o(i("64c0"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,i("5486")["createPage"])},"5f59":function(e,t,i){"use strict";var o=i("822e"),n=i.n(o);n.a},"63aa":function(e,t,i){"use strict";var o;i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return o}));var n=function(){var e=this,t=e.$createElement,i=(e._self._c,e.__map(e.xiaoxi_list,(function(t,i){var o=e.__get_orig(t),n=t.user&&1==t.msgtype&&1!=t.iswithdraw?e.replace_em(t.content):null,s=t.user?e._f("timeStamp")(t.uptime):null;return{$orig:o,m0:n,f0:s}})));e.$mp.data=Object.assign({},{$root:{l0:i}})},s=[]},"64c0":function(e,t,i){"use strict";i.r(t);var o=i("63aa"),n=i("7f42");for(var s in n)"default"!==s&&function(e){i.d(t,e,(function(){return n[e]}))}(s);i("5f59");var a,r=i("f0c5"),u=Object(r["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);t["default"]=u.exports},"7f42":function(e,t,i){"use strict";i.r(t);var o=i("1d3d"),n=i.n(o);for(var s in o)"default"!==s&&function(e){i.d(t,e,(function(){return o[e]}))}(s);t["default"]=n.a},"822e":function(e,t,i){}},[["4c34","common/runtime","common/vendor"]]]);